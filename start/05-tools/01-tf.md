# TF

base_link到base_laser的变换

```bash
ros2 run tf2_ros static_transform_publisher --x 0.1 --y 0.0 --z 0.2 --roll 0.0 --pitch 0.0 --yaw 0.0 --frame-id base_link --child-frame-id base_laser
```

```plain
[INFO] [1767962419.675021515] [static_transform_publisher_MNBXplDs9YhIJ2BH]: Spinning until stopped - publishing transform
translation: ('0.100000', '0.000000', '0.200000')
rotation: ('0.000000', '0.000000', '0.000000', '1.000000')
from 'base_link' to 'base_laser'
```

```bash
sudo apt install ros-jazzy-mrpt-apps
```

```bash
3d-rotation-converter
```

![3d-rotation-converter](/assets/3d-rotation-converter.png)

```bash
sudo apt install ros-$ROS_DISTRO-tf-transformations
sudo apt install python3-transforms3d
```

```python
import rclpy
from rclpy.node import Node

from geometry_msgs.msg import TransformStamped
from tf2_ros import TransformBroadcaster

import math


class TfBroadcaster(Node):

    def __init__(self):
        super().__init__('tf_broadcaster')

        self.br = TransformBroadcaster(self)
        self.timer = self.create_timer(0.1, self.broadcast_tf)

        self.angle = 0.0

    def broadcast_tf(self):
        t = TransformStamped()

        # 时间戳
        t.header.stamp = self.get_clock().now().to_msg()

        # 父子坐标系
        t.header.frame_id = 'base_link'
        t.child_frame_id = 'laser'

        # 平移（单位：米）
        t.transform.translation.x = 0.2
        t.transform.translation.y = 0.0
        t.transform.translation.z = 0.1

        # 旋转（四元数）
        qz = math.sin(self.angle / 2.0)
        qw = math.cos(self.angle / 2.0)

        t.transform.rotation.x = 0.0
        t.transform.rotation.y = 0.0
        t.transform.rotation.z = qz
        t.transform.rotation.w = qw

        self.br.sendTransform(t)

        self.angle += 0.01


def main():
    rclpy.init()
    node = TfBroadcaster()
    rclpy.spin(node)
    node.destroy_node()
    rclpy.shutdown()


if __name__ == '__main__':
    main()
```
