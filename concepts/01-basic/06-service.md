# 服务（Service）

在 ROS 2 中，服务指的是远程过程调用。换句话说，一个节点可以向另一个节点发起远程过程调用，该节点将执行计算并返回结果。

这种结构体现在服务消息定义的格式上：

```rosmsg
uint32 request
---
uint32 response
```

在 ROS 2 中，服务被期望能够快速返回，因为客户端通常在等待结果。服务不应用于长时间运行的过程，特别是那些可能需要因异常情况而被中断的过程。如果你有一个将执行长时间计算的服务，考虑使用动作（action）代替。

服务通过服务名称来标识，该名称看起来与主题名称非常相似（但位于不同的命名空间中）。

一个服务由两部分组成：服务服务器和服务客户端。

## 接口定义

服务是一种请求/响应通信，其中客户端（请求者）等待服务器（响应者）进行短期计算并返回结果。

服务在 ROS 包的 `srv/` 目录下的 `.srv` 文件中描述和定义。

服务描述文件由请求和响应 `msg` 类型组成，两者之间用 `---` 分隔。任何两个用 `---` 连接的 `.msg` 文件都是一个合法的服务描述。

这里是一个非常简单的服务示例，它接收一个字符串并返回一个字符串：

```rosmsg
string str
---
string str
```

当然我们可以更复杂（如果你想引用同一包中的消息，则不必提及包名）：

```rosmsg
# request constants
int8 FOO=1
int8 BAR=2
# request fields
int8 foobar
another_pkg/AnotherMessage msg
---
# response constants
uint32 SECRET=123456
# response fields
another_pkg/YetAnotherMessage val
CustomMessageDefinedInThisPackage value
uint32 an_integer
```

你不能在一个服务内部嵌入另一个服务。

## 服务服务器

服务服务器是接收远程过程请求并对其执行计算的实体。例如，假设 ROS 2 消息包含以下内容：

```rosmsg
uint32 a
uint32 b
---
uint32 sum
```

服务服务器将是接收此消息的实体，将 `a` 和 `b` 相加，并返回 `sum`。

> [!Note]
> 每个服务名称下应该只有一个服务服务器。当同一个服务名称存在多个服务服务器时，无法确定哪个服务服务器会接收客户端请求。

## 服务客户端

服务客户端是一个请求远程服务服务器代表其执行计算的实体。根据上面的示例，服务客户端是创建包含 `a` 和 `b` 的初始消息，并等待服务服务器计算和返回结果的实体。

与服务服务器不同，使用相同服务名称的服务客户端可以有任意数量。
