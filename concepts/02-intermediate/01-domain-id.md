# ROS_DOMAIN_ID

如前所述，ROS 2 用于通信的默认中间件是 DDS。在 DDS 中，不同逻辑网络共享物理网络的主要机制称为域 ID。同一域上的 ROS 2 节点可以自由发现并向彼此发送消息，而不同域上的 ROS 2 节点则不能。所有 ROS 2 节点默认使用域 ID 0。为了避免在同一网络上运行 ROS 2 的不同计算机组之间的干扰，每个组应设置不同的域 ID。

## 选择域 ID

要跳过背景信息并直接选择一个安全的数字，只需选择 0 到 101 之间的域 ID（包括 0 和 101）。

[《Statically configure a Firewall to let OMG DDS Traffic through》](https://community.rti.com/content/forum-topic/statically-configure-firewall-let-omg-dds-traffic-through) 解释了有关端口计算的详情内容。

域 ID 由 DDS 用于计算用于发现和通信的 UDP 端口。UDP 端口是无符号 16 位整数，因此可分配的最高端口号是 65535。用上文公式做一些计算，这意味着可能分配的最高域 ID 是 232，而可分配的最低域 ID 是 0。

为了最大兼容性，在选择域 ID 时应遵循一些额外的平台特定约束。特别是，最好避免在操作系统的临时端口范围内分配域 ID。这可以避免 ROS 2 节点使用的端口与其他计算机上的网络服务之间可能发生的冲突。

## 平台特定约束

- 默认情况下，Linux 内核使用端口 32768-60999 作为临时端口。这意味着域 ID 0-101 和 215-232 可以安全使用，而不会与临时端口冲突。Linux 中的临时端口范围可以通过在 `/proc/sys/net/ipv4/ip_local_port_range` 中设置自定义值来配置。如果使用自定义的临时端口范围，上述数字可能需要相应调整

- 默认情况下，macOS 上的临时端口范围是 49152-65535。这意味着可以安全地使用 0-166 的域 ID，而不会与临时端口冲突。在 macOS 中，可以通过为 `net.inet.ip.portrange.first` 和 `net.inet.ip.portrange.last` 设置自定义 sysctl 值来配置临时端口范围。如果使用自定义的临时端口范围，上述数字可能需要相应调整。

- 默认情况下，Windows 上的临时端口范围是 49152-65535。这意味着可以安全地使用 0-166 的域 ID，而不会与临时端口冲突。在 Windows 中，可以通过使用 netsh 配置临时端口范围。如果使用自定义的临时端口范围，上述数字可能需要相应调整。

## 参与者约束

每台计算机上运行的每个 ROS 2 进程都会创建一个 DDS“参与者”。由于每个 DDS 参与者占用计算机的两个端口，在一台计算机上运行超过 120 个 ROS 2 进程可能会溢出到其他域 ID 或临时端口。

如果已知计算机在任何时候都只会在单个域 ID 上运行，并且域 ID 足够低，那么创建比这更多的 ROS 2 进程是安全的。
